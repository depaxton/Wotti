# תהליך שחרור עדכונים - Wotti

## סקירה כללית

מערכת העדכון האוטומטית מאפשרת לך לשחרר עדכונים לכל המשתמשים שלך בצורה פשוטה ואוטומטית. הלקוחות יקבלו את העדכונים אוטומטית ללא התערבות.

---

## תהליך שחרור עדכון - שלב אחר שלב

### שלב 1: הכנת העדכון

1. **ביצוע שינויים בקוד**
   - ערוך את הקבצים הנדרשים
   - בדוק שהכל עובד תקין
   - ודא שהאפליקציה רצה תקין לאחר השינויים

2. **עדכון גרסה**
   - פתח את `package.json`
   - עדכן את השדה `version`:
     - **Patch**: `1.0.0` → `1.0.1` (תיקוני באגים)
     - **Minor**: `1.0.1` → `1.0.2` (תכונות חדשות)
     - **Major**: `1.0.0` → `1.1.0` (שינויים גדולים)

3. **יצירת חבילת עדכון**
   - צור ZIP של כל הקבצים **למעט**:
     - `node_modules/` - לא נכלל (יעודכן לאחר העדכון)
     - `.wwebjs_auth/` - לא נכלל (אימות WhatsApp נשמר)
     - `data/` - נתוני משתמש, לא נכלל (חייב להישמר)
     - `.git/` - לא נכלל
     - `*.log` - לא נכלל
     - `updates/` - לא נכלל (תיקייה זמנית)
   - שם הקובץ: `wotti-{גרסה}.zip` (לדוגמה: `wotti-1.0.1.zip`)

### שלב 2: העלאת העדכון לשרת

**אופציה A: GitHub Releases (מומלץ - חינמי ופשוט)**
```
1. פתח את ה-Repository ב-GitHub
2. לחץ על "Releases" → "Create a new release"
3. Tag version: v1.0.1 (להתאים לגרסה)
   - בחר "Create new tag"
   - כתוב: v1.0.1
4. Release title: "Wotti v1.0.1"
5. Description: הדבק את ה-changelog
6. Upload את קובץ ה-ZIP כ-Asset
   - גרור ושחרר את wotti-1.0.1.zip
7. לחץ "Publish release"
8. לאחר הפרסום, לחץ ימני על קובץ ה-ZIP → "Copy link address"
   - זה יהיה ה-downloadUrl שלך
```

**אופציה B: שרת אישי / CDN**
```
1. העלה את ה-ZIP לשרת שלך
2. ודא שהקובץ נגיש דרך HTTPS (חשוב לאבטחה)
3. העתק את ה-URL המלא לקובץ
   - לדוגמה: https://your-server.com/updates/wotti-1.0.1.zip
```

### שלב 3: עדכון קובץ הגרסה

צור/עדכן קובץ `version.json` בשרת שלך (או GitHub Raw) עם התוכן:

```json
{
  "version": "1.0.1",
  "downloadUrl": "https://github.com/yourusername/wotti/releases/download/v1.0.1/wotti-1.0.1.zip",
  "releaseDate": "2024-01-15",
  "changelog": "תיקון באגים + תכונה חדשה X",
  "required": false,
  "minVersion": null
}
```

**השדות:**
- `version` - מספר הגרסה החדשה (חייב להתאים ל-package.json)
- `downloadUrl` - קישור ישיר להורדת ה-ZIP (חייב להיות נגיש)
- `releaseDate` - תאריך שחרור בפורמט YYYY-MM-DD
- `changelog` - רשימת שינויים (בעברית או אנגלית)
- `required` - אם `true`, הלקוחות חייבים לעדכן (אינם יכולים לדחות)
- `minVersion` - גרסה מינימלית נדרשת (null = כל הגרסאות)

**הצבת הקובץ:**

*GitHub:*
1. צור קובץ `version.json` ב-repo שלך
2. או השתמש ב-GitHub Pages
3. או השתמש ב-GitHub Raw URL:
   ```
   https://raw.githubusercontent.com/yourusername/wotti/main/version.json
   ```

*שרת אישי:*
- העלה את הקובץ לנתיב נגיש
- לדוגמה: `https://your-server.com/updates/version.json`
- ודא שה-URL נגיש וציבורי

---

## תהליך קבלת עדכון (צד הלקוחות) - אוטומטי

### מה קורה ברקע:

1. **בדיקת גרסה** (כל 10 דקות או בזמן אתחול)
   ```
   האפליקציה → בודקת version.json → משווה גרסאות
   ```

2. **זיהוי עדכון**
   ```
   אם הגרסה בשרת > הגרסה המקומית → יש עדכון!
   ```

3. **התראה למשתמש** (אופציונלי)
   ```
   אם SHOW_UPDATE_NOTIFICATION = true
   → מציג הודעה: "יש עדכון זמין! מתעדכן..."
   ```

4. **הורדה אוטומטית**
   ```
   האפליקציה → מורידה את ה-ZIP → שומרת בתיקייה זמנית (updates/temp/)
   ```

5. **גיבוי גרסה נוכחית**
   ```
   האפליקציה → יוצרת גיבוי של הגרסה הנוכחית (updates/backup/)
   ```

6. **אימות העדכון**
   ```
   האפליקציה → בודקת את ה-ZIP (גודל, פורמט, תוכן)
   ```

7. **חילוץ והתקנה**
   ```
   האפליקציה → מחלצת את ה-ZIP → מחליפה קבצים (חוץ מ-data/, .wwebjs_auth/)
   ```

8. **התקנת dependencies**
   ```
   האפליקציה → מריצה npm install (לעדכון node_modules)
   ```

9. **אתחול מחדש**
   ```
   האפליקציה → עוצרת עצמה → מאתחלת עצמה → הלקוח מקבל גרסה מעודכנת!
   ```

---

## הגדרת מערכת העדכון

### קובץ הגדרות: `config/updateConfig.js`

```javascript
export const UPDATE_CONFIG = {
  // URL לקובץ version.json
  UPDATE_CHECK_URL: "https://raw.githubusercontent.com/yourusername/wotti/main/version.json",
  
  // תדירות בדיקה (בדקות)
  UPDATE_CHECK_INTERVAL: 10,
  
  // האם עדכונים אוטומטיים מופעלים
  AUTO_UPDATE_ENABLED: true,
  
  // האם להציג התראה לפני עדכון
  SHOW_UPDATE_NOTIFICATION: true,
  
  // תיקייה זמנית לעדכונים
  UPDATE_TEMP_DIR: "./updates/temp",
  
  // תיקיית גיבוי
  UPDATE_BACKUP_DIR: "./updates/backup"
};
```

**⚠️ חשוב:** עדכן את `UPDATE_CHECK_URL` לכתובת האמיתית של `version.json` שלך!

---

## דוגמה מעשית

### יום שני, 14:00 - שחרור עדכון v1.0.1

**אתה עושה:**
```bash
1. עדכון package.json: "version": "1.0.1"
2. יצירת ZIP: wotti-1.0.1.zip
3. העלאה ל-GitHub Releases
4. עדכון version.json על השרת
5. בדיקה שהקובץ נגיש
```

**הלקוחות מקבלים:**
```
14:05 - לקוח 1: אפליקציה בודקת, מזהה עדכון, מורידה ומעדכנת ✅
14:10 - לקוח 2: אפליקציה נפתחת, בודקת, מעדכנת ✅
14:15 - לקוח 3: בדיקה תקופתית מזהה עדכון, מעדכנת ✅
14:20 - לקוח 4: בדיקה תקופתית מזהה עדכון, מעדכנת ✅
```

**כל הלקוחות מעודכנים תוך 10-20 דקות!**

---

## מבנה הקבצים לעדכון

```
Wotti/
├── services/
│   └── updateService.js      # השירות הראשי לעדכונים
├── config/
│   └── updateConfig.js       # הגדרות עדכון
├── utils/
│   └── updateUtils.js        # פונקציות עזר (הורדה, חילוץ)
└── updates/
    ├── temp/                 # תיקייה זמנית להורדות
    └── backup/               # גיבויים של גרסאות קודמות
```

---

## בטיחות וביטחון

### מה נשמר בעדכון (לא מתעדכן):
✅ `data/` - כל נתוני המשתמש נשארים
   - reminders.json
   - settings.json
   - users.json
✅ `.wwebjs_auth/` - אימות WhatsApp נשמר
✅ הגדרות אישיות

### מה מתעדכן:
✅ קבצי קוד (`.js`, `.html`, `.css`)
✅ קבצי תצורה (חוץ מ-`data/`)
✅ `package.json` - אבל צריך להריץ `npm install` לאחר העדכון

### גיבוי אוטומטי:
- לפני כל עדכון, האפליקציה שומרת גיבוי של הגרסה הקודמת ב-`updates/backup/`
- במקרה של כישלון, המערכת משחזרת את הגרסה הקודמת אוטומטית
- גיבויים ישנים נמחקים אוטומטית (משאירים רק את 3 האחרונים)

---

## פתרון בעיות

### הלקוח לא מקבל עדכון:
1. **בדוק נגישות:**
   - פתח בדפדפן: `UPDATE_CHECK_URL` (מה-updateConfig.js)
   - ודא שקובץ `version.json` נגיש וציבורי

2. **בדוק גרסאות:**
   - ודא שהגרסה ב-`version.json` גבוהה מהגרסה המקומית
   - בדוק ב-`package.json` של הלקוח מה הגרסה שלו

3. **בדוק הגדרות:**
   - ודא ש-`AUTO_UPDATE_ENABLED = true` ב-`updateConfig.js`
   - בדוק ש-`UPDATE_CHECK_URL` נכון

4. **בדוק לוגים:**
   - חפש הודעות עדכון ב-console/לוגים
   - בדוק אם יש שגיאות חיבור

### עדכון נכשל:
1. **גיבוי אוטומטי:**
   - האפליקציה תשחזר אוטומטית לגרסה הקודמת
   - בדוק את התיקייה `updates/backup/`

2. **בדוק לוגים:**
   - חפש שגיאות ב-console
   - בדוק את `updates/update.log` אם קיים

3. **בדוק מקום בדיסק:**
   - ודא שיש מספיק מקום להורדה
   - נדרש לפחות פי 2 מגודל ה-ZIP

4. **בדוק הרשאות:**
   - ודא שהתיקייה נגישה לכתיבה
   - בדוק הרשאות על `updates/`

### עדכון חלקי:
1. **אימות קבצים:**
   - האפליקציה תזהה קבצים חסרים
   - תדרוש עדכון מחדש

2. **ניסיון חוזר:**
   - המערכת תנסה להוריד שוב
   - אם נכשל 3 פעמים, תעצור

3. **גיבוי אוטומטי:**
   - במקרה של כישלון, המערכת תשחזר מגיבוי

---

## טיפים וbest practices

### לפני שחרור עדכון:
1. ✅ **בדוק תמיד** - ודא שהגרסה החדשה עובדת תקין על מחשב בדיקה
2. ✅ **תיעוד שינויים** - מלא `changelog` בבירור ומפורט
3. ✅ **גרסאות גדולות** - אם יש שינויי API או שינויים מרכזיים, הגדר `required: true`
4. ✅ **תקשורת** - הודע ללקוחות על עדכונים גדולים מראש

### בכתיבת Changelog:
- כתוב בעברית ברורה
- הסבר מה השתנה ומדוע
- ציין אם יש פעולות נדרשות מהמשתמש
- לדוגמה:
  ```
  "תיקון: בעיה בשליחת תזכורות"
  "תוספת: תכונה חדשה לניהול קבוצות"
  "שיפור: ביצועים מהירים יותר"
  ```

### אבטחה:
- ✅ השתמש תמיד ב-HTTPS ל-downloadUrl
- ✅ ודא שהשרת מאובטח
- ✅ בדוק את תקינות ה-ZIP לפני העלאה
- ✅ אל תכלול מידע רגיש ב-ZIP

---

## פקודות מהירות

כש-Cursor AI מבקש לשחרר עדכון, הוא יבצע:
1. ✅ עדכון גרסה ב-`package.json`
2. ✅ יצירת ZIP (לא כולל קבצים לא נחוצים)
3. ✅ יצירת `version.json` מוכן להעלאה
4. ✅ הוראות ברורות להעלאה לשרת

**פשוט תגיד: "שחרר עדכון גרסה X.Y.Z" או "הכן עדכון"**

---

## שאלות נפוצות

**Q: כמה זמן לוקח עד שהלקוחות מקבלים עדכון?**
A: עד 10-20 דקות, תלוי מתי הבדיקה הבאה מתוזמנת.

**Q: האם הלקוח יכול לדחות עדכון?**
A: אם `required: false`, כן (אבל עדיין יקבל התראה). אם `required: true`, לא.

**Q: מה קורה אם העדכון נכשל?**
A: המערכת תשחזר אוטומטית לגרסה הקודמת מהגיבוי.

**Q: האם נתוני המשתמש נשמרים?**
A: כן! התיקייה `data/` לא מתעדכנת לעולם.

**Q: האם אימות WhatsApp נשמר?**
A: כן! התיקייה `.wwebjs_auth/` לא מתעדכנת לעולם.

**Q: מה קורה ל-node_modules?**
A: המערכת מריצה `npm install` לאחר העדכון, כך ש-node_modules מתעדכן אוטומטית.

---

## תמיכה וסיוע

אם נתקלת בבעיה:
1. בדוק את הלוגים
2. בדוק את ה-URLs ב-`updateConfig.js`
3. ודא שהשרת נגיש
4. בדוק את גודל הקבצים (לא גדולים מדי)

לסיוע נוסף, עיין בקוד ב-`services/updateService.js` ו-`utils/updateUtils.js`.

